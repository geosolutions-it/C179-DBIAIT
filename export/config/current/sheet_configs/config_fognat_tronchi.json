{
   "sheet":"Fognat_tronchi",
   "skip":false,
   "sources":[
      {
         "fields":[
            {"name":"fognat_tronchi.idgis", "alias": "idgis"},
            {"name":"fognat_tronchi.idgis_rete", "alias": "idgis_rete"},
            {"name":"fognat_tronchi.recapito", "alias": "recapito"},
            {"name":"fognat_tronchi.id_materiale", "alias": "id_materiale"},
            {"name":"fognat_tronchi.id_conservazione", "alias": "id_conservazione"},
            {"name":"fognat_tronchi.diametro", "alias": "diametro"},
            {"name":"fognat_tronchi.anno", "alias": "anno"},
            {"name":"fognat_tronchi.funziona_gravita", "alias": "funziona_gravita"},
            {"name":"fognat_tronchi.lunghezza", "alias": "lunghezza"},
            {"name":"fognat_tronchi.idx_materiale", "alias": "idx_materiale"},
            {"name":"fognat_tronchi.idx_diametro", "alias": "idx_diametro"},
            {"name":"fognat_tronchi.idx_anno", "alias": "idx_anno"},
            {"name":"fognat_tronchi.idx_lunghezza", "alias": "idx_lunghezza"},
            {"name":"fognat_tronchi.depurazione", "alias": "depurazione"},
            {"name":"fognat_tronchi.id_refluo_trasportato", "alias": "id_refluo_trasportato"},
            {"name":"acq_condotta.data_esercizio", "alias": "data_esercizio"}
         ],
         "table":{
            "name":"fognat_tronchi"
         },
         "join": [
             {
                 "type": "left",
                 "table": {
                     "name": "acq_condotta"
                 },
                 "on": [
                     "acq_condotta.idgis",
                     "fognat_tronchi.idgis"
                 ],
                 "cond": "="
             }
         ]
      },
      {
         "fields":[
            {"name":"fgn_condotta.codice_ato", "alias": "codice_ato"}
         ],
         "table":{
            "name":"fgn_condotta"
         },
         "join": [
             {
                 "type": "left",
                 "table": {
                     "name": "acq_rete_racc"
                 },
                 "on": [
                     "acq_rete_racc.idgis",
                     "fgn_condotta.id_rete"
                 ],
                 "cond": "="
             }
         ]
      }
   ],
   "columns":[
      {"id": "61200","transformation": { "func": "DIRECT", "params": { "field": "codice_ato"}}},
      {"id": "61400","transformation": { "func": "DIRECT", "params": { "field": "idgis"}}},
      {"id": "61700","transformation": { "func": "DIRECT", "params": { "field": "diametro"}}},
      {"id": "61500","transformation": { "func": "DOMAIN", "params": { "field": "d_materiale", "domain_name":  "D_MATERIALE_IDR"}}},
      {"id": "61600","transformation": { "func": "DOMAIN", "params": { "field": "d_stato_cons", "domain_name":  "D_STATO_CONS"}}},
      {"id":"61800", "transformation":{
            "func": "IF",
            "params": {
                "field": "data_esercizio",
                "cond": {
                        "operator": "=",
                        "value": "",
                        "result": "9999",
                        "else": "data_esercizio"
                    }
                }
            }
      },
      {"id": "61900","transformation": { "func": "DOMAIN", "params": { "field": "d_tipo_acqua", "domain_name":  "D_F_T_ACQUA"}}},
      {"id":"62100", "transformation":{ "func":"CASE", "params": {"field":"d_materiale", "cond": [
             {"case": "WHEN", "operator": "=", "value": "1", "result": "X"},
             {"case": "WHEN", "operator": "!= 1 and (TIPO_RILIEVO = ASB or TIPO_RILIEVO = DIN)", "value": "1", "result": "A"},
             {"case": "WHEN", "operator": "!= 1 and (TIPO_RILIEVO != ASB and TIPO_RILIEVO != DIN)", "value": "1", "result": "B"}
         ]}}},
        {"id":"62200", "transformation":{ "func":"CASE", "params": {"field":"diametro", "cond": [
             {"case": "WHEN", "operator": "=", "value": "1", "result": "X"},
             {"case": "WHEN", "operator": "!= '' and (TIPO_RILIEVO = ASB or TIPO_RILIEVO = DIN)", "value": "1", "result": "A"},
             {"case": "WHEN", "operator": "!= '' and (TIPO_RILIEVO != ASB and TIPO_RILIEVO != DIN)", "value": "1", "result": "B"}
         ]}}},
       {"id":"62300", "transformation":{ "func":"CASE", "params": {"field":"data_esercizio", "cond": [
             {"case": "WHEN", "operator": "=", "value": "9999", "result": "X"},
             {"case": "WHEN", "operator": "!= 9999 and (TIPO_RILIEVO = ASB or TIPO_RILIEVO = DIN)", "value": "1", "result": "A"},
             {"case": "WHEN", "operator": "!= 9999 and (TIPO_RILIEVO != ASB and TIPO_RILIEVO != DIN)", "value": "1", "result": "B"}
         ]}}}
   ]
}