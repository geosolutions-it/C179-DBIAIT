{
   "sheet":"Fognat_tronchi",
   "skip":false,
   "sources":[
      {
         "fields":[
            {"name":"fognat_tronchi.idgis", "alias": "idgis"},
            {"name":"fognat_tronchi.idgis_rete", "alias": "idgis_rete"},
            {"name":"fognat_tronchi.recapito", "alias": "recapito"},
            {"name":"fognat_tronchi.id_materiale", "alias": "id_materiale"},
            {"name":"fognat_tronchi.id_conservazione", "alias": "id_conservazione"},
            {"name":"fognat_tronchi.diametro", "alias": "diametro"},
            {"name":"fognat_tronchi.anno", "alias": "anno"},
            {"name":"fognat_tronchi.funziona_gravita", "alias": "funziona_gravita"},
            {"name":"fognat_tronchi.lunghezza", "alias": "lunghezza"},
            {"name":"fognat_tronchi.idx_materiale", "alias": "idx_materiale"},
            {"name":"fognat_tronchi.idx_diametro", "alias": "idx_diametro"},
            {"name":"fognat_tronchi.idx_anno", "alias": "idx_anno"},
            {"name":"fognat_tronchi.idx_lunghezza", "alias": "idx_lunghezza"},
            {"name":"fognat_tronchi.depurazione", "alias": "depurazione"},
            {"name":"fognat_tronchi.id_refluo_trasportato", "alias": "id_refluo_trasportato"},
            {"name":"acq_condotta.data_esercizio", "alias": "data_esercizio"},
            {"name":"fgn_condotta.codice_ato", "alias": "codice_ato"}
         ],
         "table":{
            "name":"fognat_tronchi"
         },
         "join": [
             {
                 "type": "left",
                 "table": {
                     "name": "acq_condotta"
                 },
                 "on": [
                     "acq_condotta.idgis",
                     "fognat_tronchi.idgis"
                 ],
                 "cond": "="
             },{
                 "type": "left",
                 "table": {
                     "name": "fgn_condotta"
                 },
                 "on": [
                     "fgn_condotta.idgis",
                     "fognat_tronchi.idgis"
                 ],
                 "cond": "="
             }
         ]
      }
   ],
   "columns":[
      {"id": "61200","transformation": { "func": "DIRECT", "params": { "field": "codice_ato"}}},
      {"id": "61400","transformation": { "func": "DIRECT", "params": { "field": "idgis"}}},
      {"id": "61600","transformation": { "func": "DIRECT", "params": { "field": "id_conservazione"}}},
      {"id": "62000","transformation": { "func": "DIRECT", "params": { "field": "lunghezza"}}},
      {"id": "62400","transformation": { "func": "DIRECT", "params": { "field": "idx_lunghezza"}}},
      {"id": "101700","transformation": { "func": "DIRECT", "params": { "field": "funziona_gravita"}}},
      {"id": "101800","transformation": { "func": "DIRECT", "params": { "field": "depurazione"}}, "validations": [{
                    "func": "IF",
                    "params": {
                        "field": "101800",
                        "cond": [{
                            "and": [
                              {"lookup": "{101300}","operator": "=", "value": 1},
                              {"operator":  "=", "value": 0}
                            ]
                        }]
                    },
                    "warning": "Foglio: {SHEET}, Riga:{ROW}, Codice_ato: {CODICE_ATO}, Campo: {FIELD}: Field is not 0"
                }
            ]},
      {"id": "61700","transformation": { "func": "DIRECT", "params": { "field": "diametro"}}, "validations": [{
                    "func": "IF",
                    "params": {
                        "field": "61700",
                        "cond": [{
                            "and": [
                              {"lookup": "{61800}","operator": ">=", "value": 2002},
                              {"operator":  "!=", "value": "None"}
                            ]
                        }]
                    },
                    "warning": "Foglio: {SHEET}, Riga:{ROW}, Codice_ato: {CODICE_ATO}, Campo: {FIELD}: Field is greater than 2002 or is None"
                }
            ]},
      {"id": "61500","transformation": { "func": "DIRECT", "params": { "field": "id_materiale"}}, "validations": [{
                    "func": "IF",
                    "params": {
                        "field": "61500",
                        "cond": [{
                            "and": [
                              {"lookup": "{61800}","operator": ">=", "value": 2014},
                              {"operator":  "!=", "value": "None"}
                            ],
							"and": [
                              {"lookup": "{61800}","operator": "<", "value": 2014}
                            ]
                        }]
                    },
                    "warning": "Foglio: {SHEET}, Riga:{ROW}, Codice_ato: {CODICE_ATO}, Campo: {FIELD}: Field is greater than 2014 or is None"
                }
            ]},
      {"id":"61800", "transformation":{
            "func": "IF",
            "params": {
                "field": "anno",
                "cond": {
                        "operator": "=",
                        "value": "",
                        "result": "9999",
                        "else": "{anno}"
                    }
                }
            }, "validations": [{
                    "func": "IF",
                    "params": {
                        "field": "61800",
                        "cond": [{
                            "or": [
                              {"operator": "<=", "value": "{REF_YEAR}"},
                              {"operator":  "=", "value": 9999}
                            ]
                        }]
                    },
                    "warning": "Foglio: {SHEET}, Riga:{ROW}, Codice_ato: {CODICE_ATO}, Campo: {FIELD}: field is lower than the {REF_YEAR}"
                }
            ]
      },
      {"id": "61900","transformation": { "func": "DIRECT", "params": { "field": "id_refluo_trasportato"}}},

      {"id": "62100","transformation": { "func": "DIRECT", "params": { "field": "idx_materiale"}}},
      {"id": "62200","transformation": { "func": "DIRECT", "params": { "field": "idx_diametro"}}},
      {"id": "62300","transformation": { "func": "DIRECT", "params": { "field": "idx_anno"}}}
   ]
}