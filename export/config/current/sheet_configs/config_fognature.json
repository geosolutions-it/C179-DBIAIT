{
    "sheet": "Fognature",
    "skip": false,
    "sources": [
        {
            "fields": [
                {"name": "a_fgn_rete_racc.codice_ato","alias": "codice_ato"},
                {"name": "a_fgn_rete_racc.denom","alias": "denom"},
                {"name": "fgn_auth_rete_racc.n_scar_piena","alias": "n_scar_piena"},
                {"name": "fgn_auth_rete_racc.episodi_allag","alias": "episodi_allag"},
                {"name": "fgn_auth_rete_racc.sn_strum_mis_port","alias": "sn_strum_mis_port", "function": "TO_BIT"},
                {"name": "fgn_auth_rete_racc.d_telecont","alias": "d_telecont"},
                {"name": "fgn_rete_racc.d_stato","alias": "d_stato"},
                {"name": "fgn_rete_racc.data_agg","alias": "data_agg"},
                {"name": "fgn_auth_rete_racc.nr_rip","alias": "nr_rip"},
                {"name": "fgn_auth_rete_racc.nr_rip_allac","alias": "nr_rip_allac"},
                {"name": "fgn_lunghezza_rete.tipo_infr","alias": "tipo_infr"},
                {"name": "fgn_lunghezza_rete.lunghezza","alias": "lunghezza"},
                {"name": "fgn_lunghezza_rete.lunghezza_dep","alias": "lunghezza_dep"},
                {"name": "fgn_lunghezza_allacci.lunghezza_allaccio","alias": "lunghezza_allaccio"},
                {"name": "abitanti_trattati.lunghezza_allaccio","alias": "lunghezza_allaccio"},
                {"name": "fgn_lunghezza_allacci.lunghezza_allaccio","alias": "lunghezza_allaccio"},
                {"name": "fgn_vol_utenze.utenze_prod_auth","alias": "utenze_prod_auth"},
                {"name": "fgn_vol_utenze.vol_fatturato","alias": "vol_fatturato"},
                {"name": "fgn_vol_utenze.vol_utenze_auth","alias": "vol_utenze_auth"},
                {"name": "fgn_lunghezza_rete.lung_rete_mista","alias": "lung_rete_mista"},
                {"name": "fgn_lunghezza_rete.lung_rete_nera","alias": "lung_rete_nera"}
            ],
            "table": {
                "name": "a_fgn_rete_racc"
            },
            "join": [
                {
                    "type": "left",
                    "table": {
                        "name": "fgn_auth_rete_racc"
                    },
                    "on": [
                        "fgn_auth_rete_racc.id_rete_racc",
                        "a_fgn_rete_racc.idgis"
                    ],
                    "cond": "="
                }, {
                    "type": "left",
                    "table": {
                        "name": "fgn_lunghezza_rete"
                    },
                    "on": [
                        "a_fgn_rete_racc.idgis",
                        "fgn_lunghezza_rete.idgis"
                    ],
                    "cond": "="
                }, {
                    "type": "left",
                    "table": {
                        "name": "abitanti_trattati"
                    },
                    "on": [
                        "a_fgn_rete_racc.idgis",
                        "abitanti_trattati.idgis"
                    ],
                    "cond": "="
                }, {
                    "type": "left",
                    "table": {
                        "name": "fgn_lunghezza_allacci"
                    },
                    "on": [
                        "a_fgn_rete_racc.codice_ato",
                        "fgn_lunghezza_allacci.codice_ato"
                    ],
                    "cond": "="
                }, {
                    "type": "left",
                    "table": {
                        "name": "fgn_vol_utenze"
                    },
                    "on": [
                        "a_fgn_rete_racc.codice_ato",
                        "fgn_vol_utenze.ids_codice_orig_fgn"
                    ],
                    "cond": "="
                }
            ],
            "filter": "WHERE a_fgn_rete_racc.d_gestore = 'PUBLIACQUA' AND a_fgn_rete_racc.d_ambito IN ('AT3', NULL) AND a_fgn_rete_racc.d_stato NOT IN ('IPR', 'IAC')"
        },
        {
            "fields": [
                {"name": "fgn_rete_racc.codice_ato","alias": "codice_ato"},
                {"name": "fgn_rete_racc.denom","alias": "denom"},
                {"name": "fgn_auth_rete_racc.n_scar_piena","alias": "n_scar_piena"},
                {"name": "fgn_auth_rete_racc.episodi_allag","alias": "episodi_allag"},
                {"name": "fgn_auth_rete_racc.sn_strum_mis_port","alias": "sn_strum_mis_port", "function": "TO_BIT"},
                {"name": "fgn_auth_rete_racc.d_telecont","alias": "d_telecont"},
                {"name": "fgn_rete_racc.d_stato","alias": "d_stato"},
                {"name": "fgn_rete_racc.data_agg","alias": "data_agg"},
                {"name": "fgn_auth_rete_racc.nr_rip","alias": "nr_rip"},
                {"name": "fgn_auth_rete_racc.nr_rip_allac","alias": "nr_rip_allac"},
                {"name": "fgn_lunghezza_rete.tipo_infr","alias": "tipo_infr"},
                {"name": "fgn_lunghezza_rete.lunghezza","alias": "lunghezza"},
                {"name": "fgn_lunghezza_rete.lunghezza_dep","alias": "lunghezza_dep"},
                {"name": "fgn_lunghezza_allacci.lunghezza_allaccio","alias": "lunghezza_allaccio"},
                {"name": "fgn_vol_utenze.utenze_prod_auth","alias": "utenze_prod_auth"},
                {"name": "fgn_vol_utenze.vol_fatturato","alias": "vol_fatturato"},
                {"name": "fgn_vol_utenze.vol_utenze_auth","alias": "vol_utenze_auth"},
                {"name": "fgn_lunghezza_rete.lung_rete_mista","alias": "lung_rete_mista"},
                {"name": "fgn_lunghezza_rete.lung_rete_nera","alias": "lung_rete_nera"}
            ],
            "table": {
                "name": "fgn_rete_racc"
            },
            "join": [
                {
                    "type": "left",
                    "table": {
                        "name": "fgn_auth_rete_racc"
                    },
                    "on": [
                        "fgn_auth_rete_racc.id_rete_racc",
                        "fgn_rete_racc.idgis"
                    ],
                    "cond": "="
                }, {
                    "type": "left",
                    "table": {
                        "name": "fgn_lunghezza_rete"
                    },
                    "on": [
                        "fgn_rete_racc.idgis",
                        "fgn_lunghezza_rete.idgis"
                    ],
                    "cond": "="
                }, {
                    "type": "left",
                    "table": {
                        "name": "fgn_lunghezza_allacci"
                    },
                    "on": [
                        "fgn_rete_racc.codice_ato",
                        "fgn_lunghezza_allacci.codice_ato"
                    ],
                    "cond": "="
                },{
                    "type": "left",
                    "table": {
                        "name": "fgn_vol_utenze"
                    },
                    "on": [
                        "fgn_rete_racc.codice_ato",
                        "fgn_vol_utenze.ids_codice_orig_fgn"
                    ],
                    "cond": "="
                }
            ],
            "filter": "WHERE fgn_rete_racc.d_gestore = 'PUBLIACQUA' AND fgn_rete_racc.d_ambito IN ('AT3', NULL) AND fgn_rete_racc.d_stato NOT IN ('IPR', 'IAC')"
        }
    ],
    "columns": [
        {"id": "101200","transformation": { "func": "CONST", "params": { "value": "B"}}},

        {"id": "59500","transformation": { "func": "DIRECT", "params": { "field": "codice_ato"}}},

        {"id": "101100","transformation": { "func": "DIRECT", "params": { "field": "lunghezza_allaccio"}}},
        {"id": "59800","transformation": { "func": "DIRECT", "params": { "field": "utenze_prod_auth"}}},
        {"id": "101500","transformation": { "func": "DIRECT", "params": { "field": "vol_fatturato"}}},
        {"id": "59900","transformation": { "func": "DIRECT", "params": { "field": "vol_utenze_auth"}}},

        {"id": "101100","transformation": { "func": "DIRECT", "params": { "field": "lunghezza_allacci"}}},

        {"id": "60200","transformation": { "func": "DIRECT", "params": { "field": "lunghezza_dep"}}},
        {"id": "59700","transformation": { "func": "DIRECT", "params": { "field": "lunghezza"}}},
        {"id": "59600","transformation": { "func": "DIRECT", "params": { "field": "denom"}}},
        {"id": "60000","transformation": { "func": "DIRECT", "params": { "field": "n_scar_piena"}}},
        {"id": "60100","transformation": { "func": "DIRECT", "params": { "field": "episodi_allag"}}},
        {"id": "101300","transformation": { "func": "DIRECT", "params": { "field": ""}}, "validations": [{
                    "func": "IF",
                    "params": {
                        "field": "101300",
                        "cond": [{
                            "and": [
                              {"lookup": "{60200}","operator": "=", "value": 0},
                              {"operator":  "=", "value": 0}
                            ]
                        }]
                    },
                    "warning": "Foglio: {SHEET}, Riga:{ROW}, Codice_ato: {CODICE_ATO}, Campo: {FIELD}: Field is not 0"
                }
            ]},
        {"id": "60300","transformation": { "func": "DIRECT", "params": { "field": "sn_strum_mis_port"}}},
        {"id": "101300","transformation": { "func": "DIRECT", "params": { "field": "sn_strum_mis_port"}}},
        {"id": "60900","transformation": { "func": "DIRECT", "params": { "field": "data_agg"}}},
        {"id": "101400","transformation": { "func": "DIRECT", "params": { "field": "nr_rip"}}},
        {"id": "101600","transformation": { "func": "DIRECT", "params": { "field": "nr_rip_allac"}}},
        {"id": "60400","transformation": { "func": "DOMAIN", "params": { "field": "d_telecont", "domain_name": "D_TELECONT"}}},
        {"id": "60500","transformation": { "func": "DOMAIN", "params": { "field": "d_stato", "domain_name": "D_STATO"}}},

        {"id": "60600","transformation": { "func": "CONST", "params": { "value": "B"}}},
        {"id": "60700","transformation": { "func": "CONST", "params": { "value": "B"}}},
        {"id": "60800","transformation": { "func": "CONST", "params": { "value": "A"}}}
    ]
}
