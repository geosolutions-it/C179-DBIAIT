{% extends "import/base-import.html" %}
{% load utils %}

{% block import_content %}
{% if object_list%}
<div class="container">
  <table class="table">
    <thead>
      <tr>
        <th>Processi</th>
        <th>Avanzamento</th>
        <th>Stato</th>
        <th></th>
      </tr>
    </thead>
    <tbody id="import-status-table">
      <tr>
        <td colspan="3" class="text-center">
          <small class="text-secondary">Attendere...</small>
        </td>
      </tr>
    </tbody>
  </table>
  <table class="table">
    <tr>
        <th>Layer</th>
        <th>Inizio</th>
        <th>Fine</th>
        <th>Status</th>
      </tr>
     <tbody id="test-import-table">
      <tr>
        <td colspan="3" class="text-center">
          <small class="text-secondary">Attendere...</small>
        </td>
      </tr>
    </tbody>
  </table>
</div>
<script>
  window.addEventListener("load", function () {
    ajax_call("{% url 'get-import-status-api-view' %}", "#import-status-table");
    setInterval(function () { ajax_call("{% url 'get-import-status-api-view' %}", "#import-status-table") }, 5000);
  });
</script>
<script>
  window.addEventListener("load", function () {
    var taskId = $("#import-status-table #task_uuid").text();
    var url = "{% url 'get-single-import-status-api-view' %}" + "?task_id=";
    setInterval(function () {
      var taskId = $("#import-status-table #task_uuid").text();
      ajax_call(url + taskId, "#test-import-table")
      }, 1000
    );
  });
</script>
{% else %}
<div class="container mt-5">
  <form method="post" action="{% url 'queue-import-view' %}" class="mt-5">
    {% csrf_token %}
    <div class="form-group mt-5">
      <select name="gpkg-name" class="form-control form-control-lg">
        {% for file in geopackage_files %}
        <option value="{{ file }}">{{ file }}</option>
        {% endfor %}
      </select>
    </div>
    <button type="submit" class="btn btn-info mb-2 btn-block">AVVIA</button>
  </form>
</div>
{% endif %}
{% endblock %}