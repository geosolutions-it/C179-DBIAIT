{% extends "base.html" %}

{% block content %}
<div class="container">
  <form method="POST" class="form-inline">
    {% csrf_token %}
    <div class="form-group mx-sm-3 mb-2">
      <label for="Ambiente" class="mx-sm-1">Ambiente: </label>
      <select name="export-schema" class="form-control">
        <option value="{{ schemas.analysis }}" selected="selected">Analisi</option>
        <!-- option value="{{ schemas.freeze }}">Storicizzazione</option -->
      </select>
    </div>
    <div class="form-group mb-2">
      <button type="submit" class="btn btn-info">
        <i class="fas fa-plus"></i>
      </button>
    </div>
  </form>
  {% block export_content%}
  <table class="table">
    <thead>
      <tr>
        <th>Utente</th>
        <th>GeoPackage</th>
        <th>Data Inizio</th>
        <th>Data Fine</th>
        <th>Esito</th>
        <th>Download</th>
      </tr>
    </thead>
    <tbody>
      {% for export in object_list %}
      <tr>
        <td>{{ export.requesting_user }}</td>
        <td>{{ export.geopackage }}</td>
        <td>{{ export.end_date|default_if_none:"--/--/----" }}</td>
        <td>{{ export.start_date|default_if_none:"--/--/----" }}</td>
        <td>
          <i class="{{ export.status_icon }}"></i>
        </td>
        <td>
          <a href="{% url 'export-download-view' task_id=export.pk %}" target="_blank">
            <i class="fas fa-download"></i>
          </a>
        </td>
      </tr>
      {% endfor %}
      </tr>
    </tbody>
  </table>
</div>
{% if error %}
<div class="modal fade" id="error-modal" tabindex="-1" role="dialog" aria-labelledby="errorModalLabel" aria-hidden="false">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body text-danger">
        {{ error }}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-info" data-dismiss="modal">va bene</button>
      </div>
    </div>
  </div>
</div>
<script>
  window.addEventListener("load", function () {
    $('#error-modal').modal('show');
  });
</script>
{% endif %}
{% endblock %}
{% endblock %}